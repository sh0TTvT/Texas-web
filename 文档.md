# 德州扑克网页游戏 - 开发文档集

## 1. 项目概述文档

### 1.1 项目名称
德州扑克在线 (Texas Hold'em Online)

### 1.2 项目简介
本项目是一款基于网页的德州扑克游戏，提供完整的德州扑克游戏体验，包含用户注册登录系统、游戏房间系统、筹码管理系统、任务系统和后台管理系统。用户可通过完成任务或在游戏中获胜获取筹码，无需真实货币交易。管理员可通过后台管理界面进行用户管理、数据监控等操作。

### 1.3 目标用户
- 德州扑克爱好者
- 休闲游戏玩家
- 希望学习德州扑克规则的新手
- 系统管理员（后台管理界面）

### 1.4 核心功能
- 用户注册与登录系统
- 德州扑克游戏核心逻辑
- 多房间/多桌游戏系统
- 筹码获取与管理系统
- 任务系统
- 玩家数据统计与排行榜
- 后台管理系统（用户管理、数据监控等）

### 1.5 技术栈概述
- 前端：HTML5, CSS3 (Tailwind CSS), JavaScript
- 后端：Node.js (Express)
- 数据库：MongoDB
- 实时通信：WebSocket
- 身份验证：JWT (JSON Web Tokens)

## 2. 功能需求规格说明书

### 2.1 用户系统

#### 2.1.1 注册功能
- 用户可通过用户名、密码、邮箱进行注册
- 系统需验证用户名唯一性
- 密码需符合安全要求（至少8位，包含字母和数字）
- 注册成功后自动登录并获得初始筹码
- 提供注册表单验证和错误提示

#### 2.1.2 登录功能
- 支持用户名/邮箱 + 密码登录
- 提供"记住我"功能
- 登录失败提示（用户名不存在/密码错误）
- 连续登录失败限制（5次后临时锁定10分钟）
- 登录状态保持（会话管理）

#### 2.1.3 用户资料管理
- 查看个人资料（用户名、注册时间、总筹码数等）
- 修改密码功能
- 上传/更换头像
- 查看游戏历史记录

### 2.2 游戏系统

#### 2.2.1 房间系统
- 多种筹码级别的房间（低、中、高）
- 房间人数显示（当前/最大）
- 快速加入功能
- 创建私人房间（可设置密码）
- 房间内聊天功能

#### 2.2.2 德州扑克核心玩法
- 标准德州扑克规则实现（底牌+公共牌）
- 完整的下注流程（底注、加注、跟注、弃牌、全押）
- 自动洗牌和发牌机制
- 手牌强度提示（新手模式）
- 游戏流程动画效果

#### 2.2.3 游戏状态管理
- 玩家在线状态显示
- 断线重连机制
- 游戏暂停/继续功能
- 超时自动操作（超时未操作自动弃牌）

### 2.3 筹码系统

#### 2.3.1 筹码获取
- 注册初始筹码（1000筹码）
- 每日登录奖励（递增式，连续登录奖励更多）
- 任务完成奖励
- 游戏胜利获得
- 等级提升奖励

#### 2.3.2 筹码消耗
- 游戏底注
- 下注消耗
- 进入高筹码房间的最低筹码要求

#### 2.3.3 筹码保护机制
- 低筹码提醒（低于100筹码时）
- 低保机制（长时间未获得筹码可领取低保）

### 2.4 任务系统

#### 2.4.1 任务类型
- 日常任务（每日重置）
  - 登录游戏
  - 完成N局游戏
  - 赢得N局游戏
  - 在游戏中完成一次全押并获胜
- 成就任务（永久有效，一次性奖励）
  - 累计登录N天
  - 总获胜局数达到N局
  - 单次赢得筹码超过N
  - 解锁特定游戏称号

#### 2.4.2 任务奖励
- 筹码奖励
- 特殊称号/徽章
- 头像框

#### 2.4.3 任务界面
- 任务列表展示（进行中/已完成）
- 任务进度显示
- 奖励领取功能

### 2.5 社交功能
- 玩家排行榜（按筹码数/胜率排序）
- 好友系统（添加/删除好友）
- 游戏内聊天（全局/房间/私聊）
- 战绩分享功能

### 2.6 后台管理系统

#### 2.6.1 管理员登录
- 专用管理员登录入口
- 强密码验证
- 登录日志记录
- 多因素认证（可选）

#### 2.6.2 用户管理
- 用户列表展示（分页、搜索、筛选）
- 用户详情查看（资料、游戏记录、筹码变动）
- 用户数据编辑（修改用户名、邮箱、筹码数等）
- 用户账号操作（禁用/启用账号、重置密码）
- 用户数据导出功能

#### 2.6.3 游戏管理
- 房间管理（创建/删除房间、修改房间参数）
- 游戏日志查看（所有对局记录）
- 异常游戏监控与处理
- 全局公告发布

#### 2.6.4 系统设置
- 基础参数配置（初始筹码、底注比例等）
- 任务配置（新增/编辑/删除任务）
- 奖励配置
- 安全设置（登录限制、操作权限等）

#### 2.6.5 数据统计与报表
- 用户增长统计
- 活跃用户统计
- 游戏数据统计（对局数、平均时长等）
- 筹码流通统计
- 自定义报表生成与导出

## 3. 用户界面/用户体验设计文档

### 3.1 整体设计风格
- 风格：现代简约风格，结合赌场元素
- 主色调：深蓝/绿色系（体现稳重与信任感）
- 辅助色：金色/红色（用于强调和交互元素）
- 字体：无衬线字体（如Inter），确保跨平台一致性
- 后台管理界面：简洁专业，以功能性为主，采用蓝色系为主色调

### 3.2 页面结构

#### 3.2.1 登录/注册页面
- 简洁的表单设计
- 品牌标识展示
- 注册/登录切换功能
- 密码可见性切换
- 响应式设计（适配移动端）
- 管理员登录入口（隐藏式或单独入口）

#### 3.2.2 主大厅页面
- 顶部导航栏（用户信息、通知、设置）
- 左侧：房间列表（按筹码级别分类）
- 中间：推荐房间/快速加入
- 右侧：任务面板/排行榜
- 底部：快捷操作栏/游戏规则入口

#### 3.2.3 游戏房间页面
- 顶部：房间信息/玩家列表
- 中央：游戏桌区域（扑克牌、筹码区）
- 底部：玩家操作区（下注、弃牌等按钮）
- 右侧：聊天面板
- 左侧：当前局信息/历史记录

#### 3.2.4 个人中心页面
- 个人资料展示区
- 筹码管理区
- 任务进度区
- 游戏统计数据（胜率、总局数等）
- 设置选项区

#### 3.2.5 后台管理页面
- 顶部：管理员信息、退出按钮、通知
- 左侧：功能导航菜单
- 中央：数据展示/操作区（根据选择的功能动态变化）
  - 用户管理列表/详情
  - 游戏数据统计图表
  - 系统设置表单
  - 日志查询结果
- 底部：版权信息、系统版本

### 3.3 交互设计

#### 3.3.1 游戏核心交互
- 下注操作：滑动选择筹码数量，点击下注按钮
- 牌局操作：清晰的按钮设计（跟注、加注、弃牌、全押）
- 筹码动画：移动时有平滑过渡效果
- 发牌动画：模拟真实发牌效果
- 胜利动画：获胜时有庆祝效果

#### 3.3.2 后台管理交互
- 数据筛选：多条件组合筛选
- 批量操作：支持选中多条记录进行批量处理
- 确认机制：重要操作（如禁用用户）需二次确认
- 操作反馈：所有操作提供明确的成功/失败反馈
- 数据导出：支持多种格式导出（CSV、Excel等）

#### 3.3.3 导航交互
- 悬停效果：按钮和可点击元素有明确的悬停状态
- 页面切换：平滑过渡效果
- 加载状态：显示加载动画
- 错误提示：清晰的错误信息和解决方案建议

### 3.4 响应式设计要求
- 桌面端：完整功能展示，多列布局
- 平板端：优化布局，保持核心功能易用性
- 移动端：简化布局，重点突出游戏操作区
- 后台管理：主要针对桌面端优化，确保数据表格清晰可读

## 4. 数据库设计文档

### 4.1 实体关系图
主要实体：User(用户)、Admin(管理员)、Room(房间)、Game(游戏)、Task(任务)、Record(记录)、SystemLog(系统日志)

### 4.2 主要数据模型

#### 4.2.1 User 集合
```
{
  _id: ObjectId,
  username: String,          // 用户名(唯一)
  email: String,             // 邮箱(唯一)
  password: String,          // 加密存储的密码
  avatar: String,            // 头像URL
  chips: Number,             // 当前筹码数
  totalGames: Number,        // 总游戏局数
  totalWins: Number,         // 总获胜局数
  joinDate: Date,            // 注册日期
  lastLogin: Date,           // 最后登录时间
  consecutiveLoginDays: Number, // 连续登录天数
  titles: [String],          // 拥有的称号
  friends: [ObjectId],       // 好友ID列表
  status: String,            // 账号状态(active/disabled)
  disableReason: String,     // 禁用原因(可选)
  settings: {                // 用户设置
    sound: Boolean,
    notifications: Boolean,
    beginnerTips: Boolean
  }
}
```

#### 4.2.2 Admin 集合
```
{
  _id: ObjectId,
  username: String,          // 管理员用户名(唯一)
  email: String,             // 邮箱(唯一)
  password: String,          // 加密存储的密码
  role: String,              // 角色(超级管理员/普通管理员)
  permissions: [String],     // 权限列表
  lastLogin: Date,           // 最后登录时间
  status: String             // 状态(active/inactive)
}
```

#### 4.2.3 Room 集合
```
{
  _id: ObjectId,
  name: String,              // 房间名称
  chipLevel: String,         // 筹码级别(low/medium/high)
  minChips: Number,          // 进入最低筹码要求
  smallBlind: Number,        // 小盲注
  bigBlind: Number,          // 大盲注
  maxPlayers: Number,        // 最大玩家数
  currentPlayers: [ObjectId], // 当前玩家ID
  isPrivate: Boolean,        // 是否私人房间
  password: String,          // 私人房间密码(可选)
  status: String,            // 状态(waiting/playing/closed)
  createTime: Date,          // 创建时间
  createdBy: ObjectId        // 创建者ID(玩家或管理员)
}
```

#### 4.2.4 Game 集合
```
{
  _id: ObjectId,
  roomId: ObjectId,          // 所属房间ID
  players: [{                // 参与玩家
    userId: ObjectId,
    chips: Number,           // 本局带入筹码
    status: String,          // 状态(active/folded/allin)
    cards: [String],         // 手牌
    betAmount: Number        // 本局已下注
  }],
  dealer: ObjectId,          // 庄家ID
  smallBlindPlayer: ObjectId,// 小盲注玩家
  bigBlindPlayer: ObjectId,  // 大盲注玩家
  communityCards: [String],  // 公共牌
  pot: Number,               // 底池大小
  currentRound: String,      // 当前回合(preflop/flop/turn/river)
  currentPlayerTurn: ObjectId, // 当前轮到的玩家
  startTime: Date,           // 开始时间
  endTime: Date,             // 结束时间
  winner: ObjectId,          // 获胜者ID
  log: [String]              // 游戏日志
}
```

#### 4.2.5 Task 集合
```
{
  _id: ObjectId,
  type: String,              // 类型(daily/achievement)
  title: String,             // 任务标题
  description: String,       // 任务描述
  target: Number,            // 目标数量
  reward: {                  // 奖励
    chips: Number,
    title: String
  },
  isRepeatable: Boolean,     // 是否可重复
  resetInterval: String,     // 重置间隔(daily/weekly)
  status: String,            // 状态(active/inactive)
  createTime: Date,          // 创建时间
  updateTime: Date           // 更新时间
}
```

#### 4.2.6 UserTask 集合
```
{
  _id: ObjectId,
  userId: ObjectId,          // 用户ID
  taskId: ObjectId,          // 任务ID
  progress: Number,          // 当前进度
  isCompleted: Boolean,      // 是否完成
  lastCompleted: Date,       // 最后完成时间
  claimStatus: String        // 领取状态(unclaimed/claimed)
}
```

#### 4.2.7 Record 集合
```
{
  _id: ObjectId,
  userId: ObjectId,          // 用户ID
  gameId: ObjectId,          // 游戏ID
  result: String,            // 结果(win/lose)
  chipsChange: Number,       // 筹码变化(正数为赢，负数为输)
  time: Date,                // 时间
  roomLevel: String          // 房间级别
}
```

#### 4.2.8 SystemLog 集合
```
{
  _id: ObjectId,
  operator: ObjectId,        // 操作人ID(管理员)
  operation: String,         // 操作类型(updateUser/banUser等)
  target: {                  // 操作目标
    type: String,            // 类型(user/room等)
    id: ObjectId             // 目标ID
  },
  details: Object,           // 操作详情
  timestamp: Date,           // 操作时间
  ipAddress: String          // 操作IP地址
}
```

#### 4.2.9 SystemSetting 集合
```
{
  _id: ObjectId,
  key: String,               // 设置项键名
  value: Object,             // 设置项值
  description: String,       // 描述
  lastUpdated: Date,         // 最后更新时间
  updatedBy: ObjectId        // 最后更新人
}
```

## 5. 游戏规则文档

### 5.1 基本规则
本游戏遵循标准德州扑克规则，每位玩家会获得两张底牌，然后依次发出五张公共牌，玩家需要用自己的两张底牌加上五张公共牌中的任意几张组成最佳的五张牌组合，通过下注竞争底池中的筹码。

### 5.2 游戏流程
1. 游戏开始前，每位玩家需缴纳底注（小盲注和大盲注，大盲注通常是小盲注的两倍）
2. 发牌阶段：每位玩家获得两张不公开的底牌
3. 第一轮下注：从大盲注后的玩家开始依次行动
4. 翻牌阶段：发出三张公共牌
5. 第二轮下注：从庄家的下一位玩家开始依次行动
6. 转牌阶段：发出第四张公共牌
7. 第三轮下注
8. 河牌阶段：发出第五张公共牌
9. 第四轮下注
10. 摊牌阶段：所有未弃牌的玩家展示手牌，最佳牌组获胜

### 5.3 操作说明
- 弃牌(Fold)：放弃本局比赛，失去已下注筹码
- 跟注(Call)：投入与当前最高下注相同的筹码
- 加注(Raise)：投入比当前最高下注更多的筹码
- 全押(All-in)：投入自己所有的筹码

### 5.4 牌型大小
从大到小排序：
1. 皇家同花顺：同一花色的10、J、Q、K、A
2. 同花顺：同一花色的五张连续牌
3. 四条：四张点数相同的牌
4. 葫芦：三张点数相同加一对
5. 同花：五张同一花色的牌
6. 顺子：五张连续点数的牌
7. 三条：三张点数相同的牌
8. 两对：两组点数相同的牌
9. 一对：两张点数相同的牌
10. 高牌：不符合以上任何牌型的牌，按单张大小比较

## 6. 任务系统设计文档

### 6.1 任务设计原则
- 任务难度递增，奖励相应增加
- 任务覆盖游戏的各种操作和行为
- 日常任务保证玩家活跃度
- 成就任务提供长期目标
- 任务可通过后台管理系统动态调整

### 6.2 日常任务列表

| 任务名称 | 任务描述 | 目标值 | 奖励筹码 |
|---------|---------|-------|---------|
| 每日登录 | 登录游戏 | 1次 | 100 |
| 初探牌局 | 完成1局游戏 | 1局 | 150 |
| 持续挑战 | 完成5局游戏 | 5局 | 300 |
| 胜利喜悦 | 赢得2局游戏 | 2局 | 400 |
| 勇敢出击 | 完成1次全押 | 1次 | 200 |
| 社交互动 | 在聊天框发送消息 | 3条 | 100 |

### 6.3 成就任务列表

| 任务名称 | 任务描述 | 目标值 | 奖励筹码 | 特殊奖励 |
|---------|---------|-------|---------|---------|
| 新手上路 | 完成首次注册并登录 | 1次 | 500 | 新手徽章 |
| 坚持不懈 | 累计登录7天 | 7天 | 1000 | 坚持不懈称号 |
| 百炼成钢 | 完成100局游戏 | 100局 | 3000 | 经验丰富徽章 |
| 常胜将军 | 赢得50局游戏 | 50局 | 5000 | 常胜将军称号 |
| 财富积累 | 拥有10000筹码 | 10000 | 2000 | 财富初级徽章 |
| 一掷千金 | 单次下注超过1000筹码 | 1000 | 1500 | 冒险精神徽章 |
| 社交达人 | 添加10位好友 | 10位 | 2500 | 社交达人称号 |

### 6.4 任务实现逻辑
- 任务进度实时更新
- 任务完成后立即通知用户
- 奖励需手动领取（除登录奖励外）
- 每日任务在凌晨0点重置
- 已完成未领取的奖励保留24小时
- 管理员可通过后台实时调整任务参数或状态

## 7. 后台管理系统设计文档

### 7.1 系统概述
后台管理系统是供管理员使用的专用界面，用于管理用户账号、监控游戏数据、配置系统参数和处理异常情况，确保游戏平台正常运行。

### 7.2 管理员角色与权限
- 超级管理员：拥有全部操作权限
- 普通管理员：拥有部分权限，如查看数据、处理用户举报等

| 权限项 | 超级管理员 | 普通管理员 |
|-------|-----------|-----------|
| 用户管理（查看） | ✓ | ✓ |
| 用户管理（编辑） | ✓ | ✓ |
| 用户管理（禁用/删除） | ✓ | ✗ |
| 房间管理 | ✓ | ✓ |
| 任务管理 | ✓ | ✗ |
| 系统设置 | ✓ | ✗ |
| 数据统计 | ✓ | ✓ |
| 日志查看 | ✓ | ✓ |

### 7.3 核心功能模块

#### 7.3.1 用户管理模块
- 用户列表展示，支持分页、搜索和多条件筛选
- 用户详情查看，包括基本信息、游戏记录、筹码变动记录
- 用户信息编辑，包括：
  - 基本资料（用户名、邮箱等）
  - 筹码数量调整（增加/减少）
  - 账号状态修改（启用/禁用）
- 批量操作功能，支持批量禁用/启用用户
- 用户数据导出（支持CSV、Excel格式）

#### 7.3.2 游戏管理模块
- 房间列表管理，支持创建、编辑、删除房间
- 房间参数配置（底注、最大玩家数等）
- 进行中游戏监控
- 游戏日志查询与导出
- 强制结束异常游戏功能

#### 7.3.3 任务管理模块
- 任务列表展示
- 新增任务（设置任务类型、目标、奖励等）
- 编辑现有任务
- 启用/禁用任务
- 任务完成情况统计

#### 7.3.4 系统设置模块
- 基础参数配置（初始筹码、连续登录奖励等）
- 安全设置（登录尝试次数限制、密码规则等）
- 公告管理（发布、编辑、删除系统公告）
- 管理员账号管理（新增、编辑、权限分配）

#### 7.3.5 数据统计与报表模块
- 用户增长趋势图表
- 活跃用户统计
- 游戏数据统计（每日对局数、平均时长等）
- 筹码流通分析
- 自定义报表生成与导出

#### 7.3.6 日志管理模块
- 管理员操作日志查询
- 用户登录日志查询
- 异常行为日志查询
- 日志筛选与导出

### 7.4 操作流程示例

#### 用户禁用流程
1. 管理员在用户列表中找到目标用户
2. 点击"禁用"按钮
3. 系统弹出确认窗口，要求输入禁用原因
4. 管理员确认并提交
5. 系统记录操作日志，更新用户状态为"禁用"
6. 该用户下次登录时将收到账号已被禁用的提示，并显示禁用原因

#### 筹码调整流程
1. 管理员在用户详情页找到"筹码调整"功能
2. 输入调整数量（正数为增加，负数为减少）
3. 输入调整原因
4. 系统验证操作权限和调整合理性
5. 确认后执行调整，更新用户筹码数
6. 记录操作日志和筹码变动记录

## 8. 测试计划文档

### 8.1 测试范围
- 功能测试：所有用户故事和功能点
- 性能测试：并发用户承载能力、响应时间
- 兼容性测试：主流浏览器和设备
- 安全测试：用户数据保护、防作弊机制、权限控制
- 易用性测试：用户界面和交互流程
- 后台管理功能测试：所有管理功能的正确性和安全性

### 8.2 测试环境
- 开发环境：供开发人员自测
- 测试环境：模拟生产环境的独立环境
- 浏览器：Chrome, Firefox, Safari, Edge最新版本
- 设备：桌面端、平板、主流手机机型

### 8.3 测试类型与用例

#### 8.3.1 功能测试
- 用户注册登录流程
- 游戏房间创建与加入
- 完整游戏流程
- 筹码增减逻辑
- 任务完成与奖励发放
- 数据统计准确性
- 后台管理功能（用户管理、房间管理等）
- 权限控制验证

#### 8.3.2 性能测试
- 单房间支持8人同时游戏的稳定性
- 100名并发用户的系统响应时间
- 数据库查询性能
- WebSocket连接稳定性
- 后台批量操作处理性能

#### 8.3.3 安全测试
- 密码加密存储验证
- SQL注入防护测试
- XSS攻击防护测试
- 防作弊机制测试
- 敏感数据传输加密
- 管理员权限越界测试
- 操作日志完整性验证

### 8.4 测试交付物
- 测试计划文档
- 测试用例集
- 缺陷报告
- 测试总结报告

## 9. 部署与维护文档

### 9.1 部署环境要求
- 服务器：2核4G以上配置
- 操作系统：Linux (Ubuntu 20.04+)
- 数据库：MongoDB 5.0+
- Node.js：v16.0+
- Web服务器：Nginx
- SSL证书：用于HTTPS
- 防火墙：配置适当的端口访问控制

### 9.2 部署流程
1. 服务器环境准备
2. 安装依赖软件
3. 配置数据库
4. 部署后端代码
5. 部署前端代码
6. 配置Nginx反向代理
7. 配置SSL证书
8. 初始化管理员账号
9. 系统测试
10. 监控系统部署

### 9.3 维护计划
- 日常备份：数据库每日自动备份
- 日志管理：保留30天日志，定期分析
- 性能监控：实时监控系统负载和响应时间
- 安全更新：定期更新依赖包，修复安全漏洞
- 版本迭代：每月一次功能更新，每两周一次bug修复
- 定期安全审计：检查异常操作和潜在安全风险

### 9.4 故障处理
- 服务器宕机：自动重启机制，备用服务器切换
- 数据库故障：从备份恢复，主从切换
- 网络问题：多线路冗余，自动切换
- 安全事件：紧急响应流程，隔离受影响系统

## 10. 项目计划与里程碑

### 10.1 阶段划分

#### 阶段一：基础开发（4周）
- 完成用户系统（注册、登录、资料管理）
- 搭建基础游戏框架
- 实现数据库设计与基础API
- 开发管理员账号系统

#### 阶段二：核心功能开发（6周）
- 完成德州扑克游戏核心逻辑
- 实现房间系统
- 开发筹码管理系统
- 实现基础UI界面
- 开发后台管理基础功能

#### 阶段三：功能完善（4周）
- 开发任务系统
- 实现社交功能
- 完善游戏动画和交互
- 优化用户体验
- 完善后台管理功能

#### 阶段四：测试与优化（2周）
- 全面功能测试
- 性能优化
- 兼容性测试
- 安全测试
- 后台管理功能专项测试

#### 阶段五：部署与上线（1周）
- 生产环境部署
- 上线前最终测试
- 管理员培训
- 正式发布

### 10.2 里程碑
1. M1（第4周末）：用户系统完成，可进行注册登录
2. M2（第7周末）：首个可玩版本，支持基本德州扑克游戏
3. M3（第10周末）：完整功能版本，包含所有核心功能和基础管理功能
4. M4（第12周末）：测试通过版本，性能和兼容性达标
5. M5（第13周末）：正式上线

### 10.3 资源需求
- 前端开发：1-2人
- 后端开发：1-2人
- UI/UX设计：1人
- 测试人员：1人
- 项目管理：1人

## 11. 风险评估与应对策略

| 风险类型 | 风险描述 | 影响程度 | 应对策略 |
|---------|---------|---------|---------|
| 技术风险 | 实时游戏同步存在延迟 | 高 | 优化WebSocket实现，使用状态预测技术 |
| 体验风险 | 新手用户难以理解游戏规则 | 中 | 增加新手引导，提供实时帮助提示 |
| 性能风险 | 高并发下系统响应缓慢 | 高 | 进行压力测试，优化数据库查询，实现缓存机制 |
| 安全风险 | 用户数据泄露或作弊行为 | 高 | 加强数据加密，实现防作弊算法，定期安全审计 |
| 管理风险 | 后台管理权限失控导致误操作 | 高 | 实现严格的权限控制，关键操作需二次确认，完整记录操作日志 |
| 进度风险 | 开发周期延误 | 中 | 合理规划任务，设置缓冲时间，优先开发核心功能 |
