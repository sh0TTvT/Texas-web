# 德州扑克网页游戏 - 技术实现计划

## 项目概述
- **开发时间：** 1个月
- **开发模式：** 个人开发
- **部署目标：** Linux云服务器（2核2GB，3Mbps带宽）
- **用户规模：** 几十人同时在线，6人/房间

## 技术栈选择
- **后端：** Go + Gin框架 + 原生WebSocket + Goroutine Pool
- **前端：** Vue3 + Quasar
- **数据库：** MySQL + Redis
- **缓存：** 本地缓存 + Redis
- **架构：** 服务端权威，客户端展示
- **游戏逻辑：** 状态机模式 + 异步消息处理

## 技术架构设计

### 后端架构
```
texas-poker-backend/
├── cmd/
│   └── main.go                 // 程序入口
├── internal/
│   ├── config/                 // 配置管理
│   ├── database/               // 数据库连接
│   ├── models/                 // 数据模型
│   ├── handlers/               // HTTP处理器
│   ├── websocket/              // WebSocket管理
│   ├── game/                   // 游戏逻辑
│   │   ├── poker/              // 德州扑克引擎
│   │   ├── room/               // 房间管理
│   │   └── statemachine/       // 状态机
│   ├── cache/                  // 缓存层
│   ├── middleware/             // 中间件
│   └── utils/                  // 工具函数
├── api/                        // API文档
├── sql/                        // 数据库脚本
├── go.mod
└── go.sum
```

### 前端架构
```
texas-poker-frontend/
├── src/
│   ├── components/             // 通用组件
│   ├── pages/                  // 页面组件
│   │   ├── auth/               // 登录注册
│   │   ├── lobby/              // 大厅
│   │   ├── game/               // 游戏房间
│   │   └── admin/              // 后台管理
│   ├── stores/                 // Pinia状态管理
│   ├── api/                    // API接口
│   ├── utils/                  // 工具函数
│   ├── assets/                 // 静态资源
│   └── router/                 // 路由配置
├── quasar.config.js
├── package.json
└── README.md
```

## 数据库设计

### MySQL表结构

#### users表
```sql
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    chips INT DEFAULT 1000,
    total_games INT DEFAULT 0,
    total_wins INT DEFAULT 0,
    avatar_url VARCHAR(255),
    status ENUM('active', 'disabled') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### rooms表
```sql
CREATE TABLE rooms (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    chip_level ENUM('low', 'medium', 'high') NOT NULL,
    min_chips INT NOT NULL,
    small_blind INT NOT NULL,
    big_blind INT NOT NULL,
    max_players INT DEFAULT 6,
    is_private BOOLEAN DEFAULT FALSE,
    password_hash VARCHAR(255),
    status ENUM('waiting', 'playing', 'closed') DEFAULT 'waiting',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### games表
```sql
CREATE TABLE games (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    room_id BIGINT NOT NULL,
    winner_id BIGINT,
    pot_amount INT NOT NULL,
    start_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    end_time TIMESTAMP NULL,
    game_log JSON,
    FOREIGN KEY (room_id) REFERENCES rooms(id)
);
```

#### game_players表
```sql
CREATE TABLE game_players (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    game_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    chips_change INT NOT NULL,
    position INT NOT NULL,
    FOREIGN KEY (game_id) REFERENCES games(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

#### admins表
```sql
CREATE TABLE admins (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role ENUM('super', 'normal') DEFAULT 'normal',
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Redis数据结构
- **房间状态：** `room:{room_id}` -> JSON
- **用户会话：** `session:{user_id}` -> JSON
- **游戏状态：** `game:{game_id}` -> JSON
- **在线用户：** `online_users` -> SET
- **房间玩家：** `room_players:{room_id}` -> SET

## API接口设计

### 用户认证API
```
POST /api/auth/register        // 用户注册
POST /api/auth/login           // 用户登录
POST /api/auth/logout          // 用户登出
GET  /api/auth/profile         // 获取用户信息
PUT  /api/auth/profile         // 更新用户信息
```

### 游戏API
```
GET  /api/rooms                // 获取房间列表
POST /api/rooms                // 创建房间
GET  /api/rooms/{id}           // 获取房间详情
POST /api/rooms/{id}/join      // 加入房间
POST /api/rooms/{id}/leave     // 离开房间
```

### 管理员API
```
POST /api/admin/auth/login     // 管理员登录
GET  /api/admin/users          // 获取用户列表
PUT  /api/admin/users/{id}     // 更新用户信息
GET  /api/admin/rooms          // 获取房间管理
GET  /api/admin/stats          // 获取统计数据
```

### WebSocket消息协议
```json
{
  "type": "game_action",
  "data": {
    "action": "bet|call|fold|raise|check",
    "amount": 100,
    "room_id": 1
  }
}
```

## 游戏逻辑设计

### 德州扑克状态机
**状态定义：**
- WaitingForPlayers：等待玩家
- PreFlop：发底牌阶段
- Flop：翻牌阶段
- Turn：转牌阶段
- River：河牌阶段
- Showdown：摊牌阶段
- GameEnd：游戏结束

### 牌型判断（按优先级排序）
1. RoyalFlush：皇家同花顺
2. StraightFlush：同花顺
3. FourOfAKind：四条
4. FullHouse：葫芦
5. Flush：同花
6. Straight：顺子
7. ThreeOfAKind：三条
8. TwoPair：两对
9. OnePair：一对
10. HighCard：高牌

### 房间管理系统
**房间生命周期：**
创建 → 等待玩家 → 游戏进行 → 游戏结束 → 重新开始/关闭

## 前端组件设计

### 核心页面组件
- **LoginPage：** 登录注册页面
- **LobbyPage：** 游戏大厅
- **GameRoomPage：** 游戏房间
- **AdminPage：** 后台管理

### 游戏UI组件
- **PokerTable：** 扑克桌组件
- **PlayerSeat：** 玩家座位组件
- **ActionButtons：** 操作按钮组件
- **ChipStack：** 筹码堆组件
- **CardComponent：** 扑克牌组件

### 状态管理设计
```javascript
// stores/game.js
export const useGameStore = defineStore('game', {
  state: () => ({
    currentRoom: null,
    playerHand: [],
    communityCards: [],
    gameState: 'waiting',
    players: []
  })
})
```

## 开发阶段规划

### 第一周：后端基础架构
**目标：** 搭建完整的后端框架和基础功能
- 项目初始化和依赖管理
- 数据库设计和连接
- 用户认证系统
- 基础API框架
- WebSocket连接管理

### 第二周：游戏核心逻辑
**目标：** 实现完整的德州扑克游戏引擎
- 德州扑克规则引擎
- 牌型判断算法
- 游戏状态机
- 房间管理系统
- 基础WebSocket游戏通信

### 第三周：前端开发
**目标：** 实现游戏前端界面和交互
- Quasar项目初始化
- 用户认证页面
- 游戏大厅页面
- 游戏房间页面
- WebSocket客户端

### 第四周：集成优化和部署
**目标：** 系统集成、测试和部署
- 前后端集成测试
- 性能优化
- 后台管理基础功能
- 移动端适配优化
- 生产环境部署

## 性能优化策略

### 服务端优化
**连接池配置：**
- MySQL连接池：最大20连接
- Redis连接池：最大50连接
- WebSocket连接池：最大1000连接

**缓存策略：**
- 用户信息本地缓存：1分钟TTL
- 房间状态Redis缓存：实时更新
- 游戏历史MySQL存储：异步写入

### 客户端优化
- 图片资源懒加载
- 组件按需加载
- WebSocket心跳机制

## 安全性设计

### 认证授权
- JWT Token认证
- 密码BCrypt加密
- 管理员双重验证

### 游戏安全
- 服务端权威验证
- 操作时效性检查
- 异常行为检测

## 部署配置

### 服务器配置
**系统要求：**
- Go 1.19+
- MySQL 8.0+
- Redis 7.0+
- Nginx反向代理

**部署方式：**
- Docker容器化部署
- 自动化部署脚本
- 监控和日志配置

## IMPLEMENTATION CHECKLIST:

1. 创建后端Go项目结构和go.mod文件
2. 配置Gin框架和基础中间件
3. 设计并创建MySQL数据库表结构
4. 实现数据库连接池和Redis连接
5. 开发用户注册登录API和JWT认证
6. 实现WebSocket连接管理器和Goroutine Pool
7. 开发德州扑克牌型判断算法
8. 实现游戏状态机和房间管理系统
9. 开发游戏核心逻辑和WebSocket消息处理
10. 创建前端Quasar项目结构
11. 实现用户认证页面（登录/注册）
12. 开发游戏大厅页面和房间列表
13. 实现游戏房间页面和扑克桌UI
14. 开发WebSocket客户端和状态管理
15. 实现游戏操作按钮和交互逻辑
16. 开发基础后台管理功能
17. 实现移动端响应式适配
18. 进行前后端集成测试
19. 性能优化和缓存实现
20. 生产环境部署配置 